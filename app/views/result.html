<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/stylesheet/result.css">
    <title>result</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="/js/func.js"></script>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
</head>

<body>
    <h1 align="center">結果画面</h1>
    <table height=400px>
        <tr>
            <!--<td width=300px>
                <div id="ranking">

                </div>
            </td>-->
            <td width=500px height=400px>
                <!--<div id="editor" style="height: 320px"></div>-->
                <div id="tab-wrap">
                    <!--ここにタブ切り替えで複数のソースコードが表示される-->
                </div>
            </td>
            <td width=200px height=400px bgcolor=white>
                <p>input</p>
                <textarea height=100px id="input" bgcolor=gray></textarea>
                <p>output ※言語によっては実行に4秒以上かかります。</p>
                <div style="white-space: pre-line" height=220px id="output" bgcolor=gray></div>
                <div align=right>
                    <input type=button onclick="run()" value="RUN">
                </div>
            </td>
        </tr>
    </table>


    <script type="text/javascript">
        // aceエディター設定
        const editor = ace.edit('editor');
        editor.setTheme("ace/theme/monokai");
        // editor.setReadOnly(true);
        editor.getSession().setMode("ace/mode/c_cpp");
        editor.setOptions({
            enableBasicAutocompletion: true,
            enableSnippets: true,
            enableLiveAutocompletion: true
        });

        const socket = io("/end");
        let num = 0;
        let codeQueData;
        //let ranking;

        // コード実行
        function run() {
            const radio = document.getElementsByName('TAB');
            const input = document.getElementById("input").value;
            const code = editor.getValue();
            for (let i = 0; i < num; i++) {
                if (radio.item(i).checked) {
                    compile(code, lang, input);
                }
            }
        };

        // リザルトイベント受信
        socket.on("result", function (data) {
            /*num = data.codeQueData.length;
            codeQueData = data.codeQueData;
            editor.setValue(codeQueData.code);
            ranking = data.ranking;
            $("#ranking").append("<div>" + ranking + "</div>");*/
            num = data.length;
            codeQueData = data;
            const content = document.getElementById('tab-wrap');
            let temp = '<input id="TAB-1" type="radio" name="TAB" class="tab-switch" checked="checked" /><label class="tab-label" for="TAB-1">code1</label><div class="tab-content"><pre><code>' + codeQueData[0].code + '</code></pre></div>';
            content.insertAdjacentHTML('afterbegin', temp);

            for (let i = 1; i < data.length; i++) {
                temp = '<input id="TAB-' + (i + 1) + '" type="radio" name="TAB" class="tab-switch" /><label class="tab-label" for="TAB-' + (i + 1) + '">code' + (i + 1) + '</label><div class="tab-content"><pre><code>' + codeQueData[i].code + '</code></pre></div>';
                content.insertAdjacentHTML('beforeend', temp);
            }
        });
    </script>
</body>

</html>